# 반려견 성장 파트너 앱 설계도 (v4.3)

**최종 수정:** 2025년 8월 18일

**핵심 방향:** 온디바이스 AI 기반 '맞춤 훈련 퀘스트' 시스템 구축

## 1. 개요

이 문서는 '반려견 성장 파트너' 앱의 개발 계획을 재수립하여, 온디바이스 AI(Gemma)를 활용한 '맞춤 훈련 퀘스트' 시스템 구축을 최우선 과제로 설정하는 것을 목표로 합니다. 이는 GPS 기능의 기술적 허들을 우회하고, 앱의 핵심 게이미피케이션 경험을 즉시 구체화하기 위한 전략입니다.

## 2. 개발 및 테스트 전략 (Development & Testing Strategy)

- **핵심 기능 우선:** '디지털 신분증'과 '훈련 퀘스트' 시스템처럼, 하드웨어 의존성이 없는 핵심 게임 로직을 먼저 구현하여 앱의 재미를 빠르게 구체화합니다.
- **하이브리드 테스트 워크플로우:**
    - **Firebase Studio:** UI 개발 및 비즈니스 로직 구현 등 대부분의 개발을 웹 기반의 빠른 개발 환경에서 진행합니다.
    - **Git 푸시:** 기능 개발이 완료되면, 원격 저장소에 코드를 푸시합니다.
    - **로컬 환경 테스트:** GPS, 카메라 등 실제 하드웨어 연동이 필요한 기능은, 노트북의 로컬 개발 환경으로 코드를 pull 한 후, 실제 휴대폰을 연결하여 테스트하고 디버깅합니다.

## 3. 개발 계획 (Development Plan)

### 1순위 (최우선): AI 훈련 퀘스트 시스템 구현

사용자의 반려견 데이터를 온디바이스 AI가 분석하여, 개인화된 훈련 퀘스트를 자동으로 생성하는 핵심 기능을 개발합니다.

1.  **AI 프롬프트 파이프라인 설계:**
    - `SurveyModel` 데이터를 AI가 이해하기 쉬운 '반려견 프로필 요약' 텍스트로 변환하는 로직을 정의합니다.
    - AI에게 일관된 지시를 내리는 '마스터 프롬프트' 템플릿을 설계합니다. (예: "너는 강아지 훈련 전문가야. 다음 프로필을 보고 3개의 훈련 퀘스트를 JSON 형식으로 만들어줘...")
    - AI가 반환할 JSON 데이터 구조(`title`, `description`, `rewardSkillId`)를 확정합니다.
2.  **Skill 모델 및 로컬 DB 구축:**
    - `lib/models/skill_model.dart` 파일을 생성하여 `Skill` 클래스를 정의합니다.
    - 앱에서 사용될 모든 스킬의 목록을 `lib/data/skills_database.dart`에 미리 정의하여, 앱 내에서 빠르게 조회할 수 있도록 합니다.
3.  **온디바이스 AI 서비스 연동:**
    - `AIService` 클래스를 `lib/services/ai_service.dart`에 생성합니다.
    - 이 서비스는 '반려견 프로필 요약'과 '마스터 프롬프트'를 입력받아, Gemma 모델을 실행하고, 결과로 나온 JSON을 파싱하여 `Quest` 객체 리스트를 반환하는 역할을 담당합니다.
4.  **UI 구현:**
    - `HomePage`에서 진입하는 **`TrainingPage.dart`**를 신규 개발합니다. 이 페이지는 `AIService`를 호출하여 현재 반려견에게 추천되는 '훈련 퀘스트' 목록을 카드 형태로 보여줍니다.
    - `DogIdCardWidget`을 수정하여, 해당 반려견이 획득한 스킬 목록을 아이콘과 함께 보여주는 영역을 추가합니다.
5.  **백엔드 로직 구현:**
    - `Dog` 모델을 수정하여, 스킬의 레벨과 경험치를 저장할 수 있는 `skills` (Map) 필드를 추가합니다.
    - `DogService`에 사용자가 훈련을 기록하고 퀘스트를 완료했을 때, 스킬 경험치를 추가하고 레벨업시키는 `addExperienceToSkill` 함수를 구현합니다.

### 2순위: '디지털 신분증' 시스템 고도화

1순위에서 개발된 스킬 시스템을 `MyDogsPage`와 `DogIdCardWidget`에 시각적으로 완벽하게 통합하여, 사용자가 반려견의 성장을 한눈에 볼 수 있도록 합니다.

### 3순위 (장기 비전): '산책 챌린지' 기능 구현

핵심 기능이 안정화되고 로컬 개발 환경이 준비되었을 때, GPS 및 지도 연동 개발에 착수합니다.
